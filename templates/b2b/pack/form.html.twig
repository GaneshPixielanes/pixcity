{% extends 'base.html.twig' %}

{% form_theme form 'bootstrap_4_layout.html.twig' %}

{% block body %}
    <style>
        .dropzone .dz-preview .dz-image {
            width: 100px !important;
            height: 100px !important;
        }
        .dropzone .dz-preview .dz-image img{
            max-width: 100%;
        }
    </style>
    <div class="container">

        {{ form_start(form) }}

            {{ form_row(form.packSkill) }}
            {{ form_row(form.title) }}
            {{ form_row(form.description) }}
            {{ form_row(form.userBasePrice) }}



                <div class="row">
                    <div class="col-md-3 col-sm-4 col-xs-6">
                        {% for image in images %}
                            <img class="img-responsive" src="{{ ('/uploads/community_media/365/'~image.name) }}" />
                        {% endfor %}
                    </div>
                </div>


                <div class="form-group">
                    <label>images</label>
                    <div class="dropzone">
                        <div id="dropzone-custom" style="background:#fff8f8;height:auto;width:auto">
                            <div class="dz-message needsclick">
                                <i class="fa fa-picture-o fa-5x" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>



            <button type="submit" class="btn btn-block btn-primary">Submit</button>

        {{ form_end(form,{render_rest:false}) }}

    </div>

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
        <link rel="stylesheet" href="{{ absolute_url(asset('build/css/dropzone.css')) }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('build/js/dropzone.js') }}"></script>



    <script>


        $(document).ready(function()
        {

            var $dropZone  = $('#dropzone-custom').dropzone({
                url:'{{ path('b2b_pack_fileuploadhandler') }}',
                maxFiles: 7,
                acceptedFiles: 'image/*',
                maxFilesize: 2,  // in Mb
                addRemoveLinks: true,
                autoProcessQueue:false,
                parallelUploads: 10,
                dictRemoveFileConfirmation:'Are you sure you want to save this image?',
                removedfile: function(file) {
                    var name = file.name;

                    $.ajax({
                        type: 'POST',
                        url: '{{ path('b2b_pack_fileuploadhandler') }}',
                        data: {name: name,request: 2},
                        sucess: function(data){
                            console.log('success: ' + data);
                        }
                    });

                    var _ref;
                    if (file.previewElement) {
                        if ((_ref = file.previewElement) != null) {
                            _ref.parentNode.removeChild(file.previewElement);
                        }
                    }
                    return this._updateMaxFilesReachedClass();

                },
                init: function () {


                    this.on("maxfilesexceeded", function(file) {
                        this.removeFile(file);
                        alert('please upload maximum 7 files');
                    });
                    this.on("sending", function(file, xhr, formData) {
                        // send additional data with the file as POST data if needed.
                        // formData.append("key", "value");
                    });
                    this.on("success", function(file, response) {
                        if (response.uploaded)
                            console.log('File Uploaded: ' + response.fileName);
                    });

                    thisDropzone = this;

                    $.get('{{ path('b2b_pack_display_image') }}', function(data) {
                        if(data.length){
                            $.each(data, function(key,value){
                                var mockFile = { name: value.name, size: value.size };
                                console.log(thisDropzone);
                                thisDropzone.options.addedfile.call(thisDropzone, mockFile);
                                thisDropzone.options.thumbnail.call(thisDropzone, mockFile, "/uploads/community_media/"+value.id+'/'+value.name);
                            });
                        }else{
                            $("#dropzone-custom").height(250);
                        }


                    });
                }
            });


            $("#submitform").on('click',function(){
                $dropZone[0].dropzone.processQueue();
            });




        });


    </script>
{% endblock %}

{% block footer_class %}simpleFooter{% endblock %}